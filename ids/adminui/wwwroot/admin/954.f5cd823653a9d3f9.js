"use strict";(self.webpackChunkadmin_ui_duende=self.webpackChunkadmin_ui_duende||[]).push([[954],{2954:(me,d,a)=>{a.r(d),a.d(d,{ViewRolesModule:()=>le});var m=a(8434),l=a(9417),w=a(9262),u=a(5139),p=a(8018),y=a(1683),C=a(8580),U=a(4193),b=a(2571),I=a(275),V=a(8389),v=a(5731),j=a(7677),F=a(7175),G=a(367),P=a(9838),$=a(7921),M=a(6303),e=a(1360),h=a(3519),z=a(345),x=a(8698),X=a(8762);const R=n=>[n];let N=(()=>{class n{constructor(t,o,s){this.rolesService=t,this.titleService=o,this.translate=s}ngOnInit(){this.getCachedRoleSubscription=this.rolesService.getCachedRole().subscribe(t=>{this.role=t,this.roleReadOnlyDictionary=new $.b(this.role);const o=this.translate.instant("Roles.Role")+" "+this.role.name+" - "+P.$9.SITE_TITLE;this.titleService.setTitle(o)})}ngOnDestroy(){this.getCachedRoleSubscription.unsubscribe()}get ReadOnlyFieldType(){return M.t}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(h.P),e.rXU(z.hE),e.rXU(p.c$))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-role-details"]],standalone:!1,decls:6,vars:11,consts:[["id","viewRoleDetails",1,"tw-container","tw-mx-auto"],[3,"label"],[3,"values","fieldType"],[3,"label","isLast"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"form")(2,"app-form-row",1),e.nrm(3,"app-readonly",2),e.k0s(),e.j41(4,"app-form-row",3),e.nrm(5,"app-readonly",2),e.k0s()()()),2&o&&(e.R7$(2),e.Y8G("label","Common.Name"),e.R7$(),e.Y8G("values",e.eq3(7,R,s.roleReadOnlyDictionary.name))("fieldType",s.ReadOnlyFieldType.Single),e.R7$(),e.Y8G("label","Common.Description")("isLast",!0),e.R7$(),e.Y8G("values",e.eq3(9,R,s.roleReadOnlyDictionary.description))("fieldType",s.ReadOnlyFieldType.Single))},dependencies:[x.Y,l.qT,l.cb,l.cV,X.O],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return n})();var f=a(1413),D=a(1594),T=a(6354),g=a(1716),E=a(9172),L=a(1397),O=a(1655),Y=a(5435),B=a(2947),J=a(5794),A=a(5424),H=a(5602),Q=a(7156),Z=a(7384),K=a(7294);function W(n,c){if(1&n){const t=e.RV6();e.qex(0,12),e.j41(1,"div",13)(2,"label",14),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"select",15),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG(2);return e.DH7(r.pageSize,s)||(r.pageSize=s),e.Njj(s)}),e.bIt("change",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setPageLength(+s.pageSize))}),e.j41(6,"option",16),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"option",17),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"option",18),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.bVm()}if(2&n){const t=e.XpG(2);e.R7$(3),e.Lme("",t.pageSize," ",e.bMT(4,6,"Nav.PerPage"),""),e.R7$(2),e.R50("ngModel",t.pageSize),e.R7$(2),e.SpI("25 ",e.bMT(8,8,"Nav.PerPage"),""),e.R7$(3),e.SpI("50 ",e.bMT(11,10,"Nav.PerPage"),""),e.R7$(3),e.SpI("100 ",e.bMT(14,12,"Nav.PerPage"),"")}}function k(n,c){if(1&n&&(e.j41(0,"app-action-bar"),e.DNE(1,W,15,14,"ng-container",11),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",(null==t.pagedResult?null:t.pagedResult.results.length)>0)}}function _(n,c){1&n&&e.nrm(0,"app-simple-loader")}function q(n,c){1&n&&(e.j41(0,"div",19)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,1,"Users.NoUsersFound")))}function ee(n,c){if(1&n){const t=e.RV6();e.j41(0,"tr")(1,"td",25),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.goToUser(s))}),e.j41(2,"b",26),e.EFF(3),e.k0s()(),e.j41(4,"td",27),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.goToUser(s))}),e.EFF(5),e.k0s(),e.j41(6,"td",27),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.goToUser(s))}),e.EFF(7),e.k0s()()}if(2&n){const t=c.$implicit;e.R7$(3),e.JRh(t.username),e.R7$(2),e.SpI(" ",t.firstName," "),e.R7$(2),e.SpI(" ",t.lastName," ")}}function te(n,c){if(1&n&&(e.j41(0,"table",20)(1,"thead")(2,"tr")(3,"th",21),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"th",22),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",22),e.EFF(10),e.nI1(11,"translate"),e.k0s()()(),e.j41(12,"tbody",23),e.DNE(13,ee,8,3,"tr",24),e.k0s()()),2&n){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,4,"Users.Username")),e.R7$(3),e.JRh(e.bMT(8,6,"Users.FirstName")),e.R7$(3),e.JRh(e.bMT(11,8,"Users.LastName")),e.R7$(3),e.Y8G("ngForOf",t.users)}}function se(n,c){if(1&n){const t=e.RV6();e.j41(0,"app-pager",28),e.bIt("onGoToPage",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.goToPage(s))}),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("totalResults",null==t.pagedResult?null:t.pagedResult.totalCount)("currentPage",t.page)("lastPage",null==t.pagedResult?null:t.pagedResult.pageCount)}}let ae=(()=>{class n extends Y.if{constructor(t,o,s,r,i,ce,pe){super(i,o,!0),this.rolesService=t,this.localize=s,this.router=r,this.errorService=ce,this.userService=pe,this.pageStream=new f.B,this.pageSizeStream=new f.B,this.userToRemove=null,this.removeSummaryTranslation="",this.removeSummary="",this.page=1,this.pageSize=25}ngOnInit(){this.isLoading=!0,this.rolesService.getCachedRole().pipe((0,D.$)()).subscribe(t=>{this.role=t,this.removeSummaryTranslation=this.removeSummaryTranslation.replace("{1}",this.role.name);const o=this.pageStream.pipe((0,T.T)(i=>(this.page=i,{searchTerm:this.searchTerm,page:i,pageSize:this.pageSize}))),s=this.pageSizeStream.pipe((0,T.T)(i=>(this.pageSize=i,{searchTerm:this.searchTerm,page:this.page,pageSize:i})));o.pipe((0,g.h)(s),(0,g.h)(this.searchSource),(0,g.h)(this.enterKeySource),(0,E.Z)({searchTerm:this.searchTerm,page:this.page,pageSize:this.pageSize}),(0,L.Z)(i=>(this.isLoading=!0,this.rolesService.getUsersInRole(t.id,i.page,i.pageSize,i.searchTerm).pipe((0,O.c)(200))))).subscribe(i=>{this.pagedResult=i,this.users=i.results,this.isLoading=!1},i=>{this.errorService.handleError(i),this.isLoading=!1})})}mapSearchTerm(t){return this.searchTerm=t,{searchTerm:this.searchTerm,page:1,pageSize:this.pageSize}}onSubmit(t){this.pageStream.next(1)}goToPage(t){this.pageStream.next(t)}setPageLength(t){this.page=1,this.pageSizeStream.next(t)}goToUser(t){const o=[this.localize.translateRoute("/users/view/"),t.subject,"roles"];this.router.navigate(o)}removeUser(t){this.removeSummary=this.removeSummaryTranslation.replace("{0}",t.username),this.userToRemove=t}delete(){this.isLoading=!0,this.userService.deleteUserRoles(this.userToRemove.subject,[this.role.name]).subscribe(t=>{let o=this.users&&1===this.users.length&&this.page>1?this.page-1:this.page;o<1&&(o=1),this.goToPage(o),this.toastr.success(this.translate.instant("Roles.Success"),this.translate.instant("Notifications.Success")),this.userToRemove=null},t=>{this.isLoading=!1,"401"===t.status&&this.toastr.warning(this.translate.instant("Roles.UnassignUnauthorized"),this.translate.instant("Notifications.Unauthorized")),this.userToRemove=null})}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(h.P),e.rXU(p.c$),e.rXU(u.QG),e.rXU(B.Ix),e.rXU(J.tw),e.rXU(A.I),e.rXU(H.D))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-role-users"]],standalone:!1,features:[e.Vt3],decls:14,vars:9,consts:[[1,"tw-container","tw-mx-auto"],["id","searchContainer",1,"tw-mb-2"],[1,"tw-flex","tw-bg-white","tw-border","tw-border-grey-300","tw-opacity-75","tw-cursor-text","tw-rounded","focus-within:tw-opacity-100","focus-within:tw-border-blue-400","tw-transition-all","tw-ease-in-out"],["for","searchTerm",1,"tw-flex","tw-items-center","tw-text-grey-500","tw-m-0","tw-ml-3"],["aria-hidden","true",1,"far","fa-search","tw-text-sm"],[1,"sr-only"],["id","searchRole","type","search","minlength","2","maxlength","25","required","","autocomplete","off",1,"tw-bg-transparent","tw-border-0","tw-text-base","tw-leading-tight","tw-px-2","tw-py-2","tw-w-full","focus:tw-outline-none","tw-transition-all","tw-ease-in-out",3,"ngModelChange","keyup","ngModel"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["id","roleUsersTable","class","datatable selectable hover",4,"ngIf"],[3,"totalResults","currentPage","lastPage","onGoToPage",4,"ngIf"],["left","",4,"ngIf"],["left",""],[1,"tw-form-select","tw-w-auto"],["for","pageSizeToggle",1,"sr-only"],["id","pageSizeToggle",1,"tw-form-control","tw-form-control-small",3,"ngModelChange","change","ngModel"],["value","25"],["value","50"],["value","100"],["role","alert",1,"tw-alert"],["id","roleUsersTable",1,"datatable","selectable","hover"],[1,"sm:tw-w-1/3","md:tw-w-1/2"],[1,"tw-hidden","sm:tw-table-cell"],["id","usersInRoleTable"],[4,"ngFor","ngForOf"],[1,"tw-max-w-0","tw-truncate",3,"click"],[1,"tw-text-blue-500"],[1,"tw-hidden","tw-max-w-0","tw-truncate","sm:tw-table-cell",3,"click"],[3,"onGoToPage","totalResults","currentPage","lastPage"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),e.nrm(4,"span",4),e.j41(5,"span",5),e.EFF(6),e.nI1(7,"translate"),e.k0s()(),e.j41(8,"input",6),e.mxI("ngModelChange",function(i){return e.DH7(s.searchTerm,i)||(s.searchTerm=i),i}),e.bIt("keyup",function(i){return s.search(i)}),e.k0s()()(),e.DNE(9,k,2,1,"app-action-bar",7)(10,_,1,0,"app-simple-loader",7)(11,q,4,3,"div",8)(12,te,14,10,"table",9)(13,se,1,3,"app-pager",10),e.k0s()),2&o&&(e.R7$(6),e.JRh(e.bMT(7,7,"Common.Search")),e.R7$(2),e.R50("ngModel",s.searchTerm),e.R7$(),e.Y8G("ngIf",!s.isLoading),e.R7$(),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",s.users&&0==s.users.length&&!s.isLoading),e.R7$(),e.Y8G("ngIf",s.users&&s.users.length>0&&!s.isLoading),e.R7$(),e.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)>0&&!s.isLoading))},dependencies:[m.Sq,m.bT,Q.B,Z.d,K.n,l.xH,l.y7,l.me,l.wz,l.BC,l.YS,l.xh,l.tU,l.vS,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return n})();var S=a(380);let ne=(()=>{class n{constructor(t,o){this.roleService=t,this.translate=o,this.roleClaims=[]}ngOnInit(){this.roleService.getCachedRole().subscribe(t=>{this.roleId=t.id.toString(),this.roleClaims=t.claims})}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(h.P),e.rXU(p.c$))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-role-additional-details"]],viewQuery:function(o,s){if(1&o&&e.GBs(S.U,5),2&o){let r;e.mGM(r=e.lsd())&&(s.claimsManagerComponent=r.first)}},standalone:!1,decls:1,vars:2,consts:[[3,"initialClaims","readOnly"]],template:function(o,s){1&o&&e.nrm(0,"app-claims-manager",0),2&o&&e.Y8G("initialClaims",s.roleClaims)("readOnly",!0)},dependencies:[S.U],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return n})();var oe=a(9115);const re=[{path:"",redirectTo:"details",pathMatch:"full"},{path:"details",component:N},{path:"users",component:ae},{path:"additionaldetails",component:ne,canActivate:[a(5866).K]}];let le=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({providers:[C.v],imports:[m.MD,w.iI.forChild(re),p.h.forChild({extend:!0}),y.Y,G.m,v.i,u.XE,V.w,b.A,I.W,F.c,v.i,U.c,l.YN,j.N,oe.P]})}}return n})()}}]);