"use strict";(self.webpackChunkadmin_ui_duende=self.webpackChunkadmin_ui_duende||[]).push([[688],{1688:(ds,N,a)=>{a.r(N),a.d(N,{EditUsersModule:()=>as});var u=a(8434),R=a(9262),G=a(5139),p=a(8018),c=a(9417),L=a(779),Q=a(534),Z=a(5291),K=a(4446),q=a(6923),ee=a(3218),B=a(8416),te=a(621),C=a(9838),b=a(9957),Y=a(380),e=a(1360),f=a(5602),M=a(5424),v=a(5794),I=a(345);let se=(()=>{class i{constructor(t,n,s,r,l){this.userService=t,this.translate=n,this.errorService=s,this.toastr=r,this.titleService=l}ngOnInit(){this.userService.getCachedUser().subscribe(t=>{this.user=t,this.userId=t.subject.toString();const n=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Additional Details")+" - "+C.$9.SITE_TITLE;this.titleService.setTitle(n)})}addClaim(t){this.userService.addUserClaim(this.userId,t).subscribe({next:()=>{this.user.claims=[...this.user.claims,t],this.userService.setCachedUser(this.user),this.claimsManager.claimAdded(t);const n=this.translate.instant("Notifications.Saving Success Title"),s=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(n,s)},error:n=>{if(401===n.status)this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarning"),this.translate.instant("Notifications.Unauthorized"));else{const r={toastBody:400===n.status?n.errorMessage:this.translate.instant("Notifications.Saving Error Message"),toastTitle:this.translate.instant("Notifications.Saving Error Title"),forceToast:!0};(this.errorService.handleError(n,r)&b.I.Toast)!==b.I.Toast&&this.toastr.error(r.toastBody,r.toastTitle)}}})}updateClaim(t){this.userService.updateUserClaim(this.userId,t).subscribe({next:()=>{this.user.claims=this.claimsManager.getAllClaims(),this.userService.setCachedUser(this.user);const n=this.translate.instant("Notifications.Saving Success Title"),s=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(n,s)},error:n=>{if(401===n.status)this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarningEdit"),this.translate.instant("Notifications.Unauthorized"));else{const r={toastBody:400===n.status?n.errorMessage:this.translate.instant("Notifications.Saving Error Message"),toastTitle:this.translate.instant("Notifications.Saving Error Title"),forceToast:!0};(this.errorService.handleError(n,r)&b.I.Toast)!==b.I.Toast&&this.toastr.error(r.toastBody,r.toastTitle)}}})}deleteClaim(t){this.userService.deleteUserClaim(this.userId,t).subscribe({next:()=>{this.user.claims=this.user.claims.filter(r=>r.type!=t.type||r.value!=t.value),this.userService.setCachedUser(this.user),this.claimsManager.claimDeleted(t);const n=this.translate.instant("Notifications.Saving Success Title"),s=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(n,s)},error:n=>{401===n.status?this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarningDelete"),this.translate.instant("Notifications.Unauthorized")):this.errorService.handleError(n,{forceToast:!0})}})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.D),e.rXU(p.c$),e.rXU(M.I),e.rXU(v.tw),e.rXU(I.hE))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-additional-details"]],viewQuery:function(n,s){if(1&n&&e.GBs(Y.U,5),2&n){let r;e.mGM(r=e.lsd())&&(s.claimsManager=r.first)}},standalone:!1,decls:5,vars:7,consts:[[1,"tw-container","tw-mx-auto","cms"],[3,"addClaimOutPut","deleteClaimOutPut","updateClaimOutPut","initialClaims","excludeRequiredClaims","excludeRoleClaims","excludeSubClaims"]],template:function(n,s){1&n&&(e.j41(0,"div",0)(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s()(),e.j41(4,"app-claims-manager",1),e.bIt("addClaimOutPut",function(l){return s.addClaim(l)})("deleteClaimOutPut",function(l){return s.deleteClaim(l)})("updateClaimOutPut",function(l){return s.updateClaim(l)}),e.k0s()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,5,"Users.Details.AdditionalDetailsBody")),e.R7$(2),e.Y8G("initialClaims",s.user.claims)("excludeRequiredClaims",!0)("excludeRoleClaims",!0)("excludeSubClaims",!0))},dependencies:[Y.U,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return i})();var k=a(6697),X=a(6303),ne=a(7921),ie=a(5312),re=a(1410),j=a(7156),S=a(7384),A=a(8698),V=a(8762),x=a(6406),E=a(8114);const ae=["appInfoModal"],oe=["revokeAppModal"],U=i=>[i],le=()=>[];function ce(i,o){1&i&&e.nrm(0,"app-simple-loader")}function me(i,o){1&i&&(e.j41(0,"div",23)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"Users.Applications.None")))}function de(i,o){1&i&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.JRh(e.bMT(2,1,"Common.Description")))}function pe(i,o){if(1&i){const t=e.RV6();e.j41(0,"td",35),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.modalInfo(s))}),e.EFF(1),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.clientDescription," ")}}function ue(i,o){if(1&i){const t=e.RV6();e.j41(0,"tr",30)(1,"td",31),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.modalInfo(s))}),e.j41(2,"b"),e.EFF(3),e.k0s()(),e.DNE(4,pe,2,1,"td",32),e.j41(5,"td")(6,"button",33),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.modalInfo(s))}),e.nrm(7,"span",34),e.j41(8,"span",27),e.EFF(9),e.nI1(10,"translate"),e.k0s()()()()}if(2&i){const t=o.$implicit,n=e.XpG(2);e.R7$(3),e.JRh(t.clientName),e.R7$(),e.vxM(n.duendeEnvironment?4:-1),e.R7$(5),e.JRh(e.bMT(10,3,"Common.Info"))}}function he(i,o){if(1&i&&(e.j41(0,"table",24)(1,"thead")(2,"tr")(3,"th"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.DNE(6,de,3,3,"th",25),e.j41(7,"th",26)(8,"span",27),e.EFF(9),e.nI1(10,"translate"),e.k0s()()()(),e.j41(11,"tbody",28),e.DNE(12,ue,11,5,"tr",29),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,4,"UserDetails.Name")),e.R7$(2),e.vxM(t.duendeEnvironment?6:-1),e.R7$(3),e.JRh(e.bMT(10,6,"Common.Actions")),e.R7$(3),e.Y8G("ngForOf",t.userApps)}}function ge(i,o){if(1&i&&e.nrm(0,"app-pager",36),2&i){const t=e.XpG();e.Y8G("totalResults",null==t.userApps?null:t.userApps.length)}}function fe(i,o){if(1&i&&(e.j41(0,"app-form-row",37),e.nrm(1,"app-readonly",17),e.k0s(),e.j41(2,"app-form-row",38),e.nrm(3,"app-readonly",17),e.k0s(),e.j41(4,"app-form-row",39),e.nrm(5,"app-readonly",17),e.k0s()),2&i){const t=e.XpG();e.Y8G("label","Common.LogoURL"),e.R7$(),e.Y8G("fieldType",t.ReadOnlyFieldType.Single)("values",e.eq3(9,U,null==t.selectedAppMap?null:t.selectedAppMap.clientLogoUrl)),e.R7$(),e.Y8G("label","Common.Description"),e.R7$(),e.Y8G("fieldType",t.ReadOnlyFieldType.Multi)("values",e.eq3(11,U,null==t.selectedAppMap?null:t.selectedAppMap.clientDescription)),e.R7$(),e.Y8G("label","Common.URL"),e.R7$(),e.Y8G("fieldType",t.ReadOnlyFieldType.Single)("values",e.eq3(13,U,null==t.selectedAppMap?null:t.selectedAppMap.clientUrl))}}function ve(i,o){1&i&&(e.j41(0,"div",21)(1,"div",40),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"ServerDependent.Users.Applications.DataEncrypted")))}function be(i,o){if(1&i&&(e.j41(0,"li",43)(1,"span",44),e.EFF(2),e.k0s()()),2&i){const t=o.$implicit;e.R7$(2),e.JRh(t)}}function Ue(i,o){if(1&i&&(e.j41(0,"dl")(1,"dt",41),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"dd")(5,"ul",42),e.Z7z(6,be,3,1,"li",43,e.fX1),e.k0s()()()),2&i){let t;const n=e.XpG();e.R7$(2),e.JRh(e.bMT(3,1,"Users.Applications.Accessible")),e.R7$(4),e.Dyx(null!==(t=null==n.selectedApp?null:n.selectedApp.scopes)&&void 0!==t?t:e.lJ4(3,le))}}let _e=(()=>{class i{get ReadOnlyFieldType(){return X.t}constructor(t,n,s,r){this.titleService=t,this.userService=n,this.translate=s,this.toastr=r,this.isLoading=!0,this.isUnavailable=!1,this.duendeEnvironment=ie.c.authServer==re.y.Duende}ngOnInit(){this.userService.getCachedUser().pipe((0,k.s)(1)).subscribe(t=>{this.user=t,this.userService.getUserApps(this.user.subject).subscribe(n=>{this.userApps=n,this.isLoading=!1,this.isUnavailable=!1;const s=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Applications")+" - "+C.$9.SITE_TITLE;this.titleService.setTitle(s)},n=>{this.isLoading=!1})})}modalInfo(t){this.selectedApp=t,this.selectedAppMap=new ne.b(t),this.appInfoModal.show()}revokeAll(){this.userService.revokeAllUserApps(this.user.subject).subscribe(t=>{this.toastr.success(this.translate.instant("Notifications.AllAppsRevoked"),this.translate.instant("Notifications.Success")),this.userApps=[]},t=>{this.toastr.error(t,this.translate.instant("Notifications.Failure"))})}revokeSingle(t){this.userService.revokeSingleUserApp(this.user.subject,t).subscribe(n=>{this.toastr.success(this.translate.instant("Notifications.AppRevoked"),this.translate.instant("Notifications.Success"));const s=this.userApps.findIndex(r=>r.clientId===t);this.userApps.splice(s,1)},n=>{this.toastr.error(n,this.translate.instant("Notifications.Failure"))})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(I.hE),e.rXU(f.D),e.rXU(p.c$),e.rXU(v.tw))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-applications"]],viewQuery:function(n,s){if(1&n&&(e.GBs(ae,5),e.GBs(oe,5)),2&n){let r;e.mGM(r=e.lsd())&&(s.appInfoModal=r.first),e.mGM(r=e.lsd())&&(s.revokeAppModal=r.first)}},standalone:!1,decls:51,vars:62,consts:[["revokeAllModal",""],["appInfoModal",""],["revokeAppModal",""],["id","editUserApplications",1,"tw-container","tw-mx-auto"],[1,"cms"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable selectable hover",4,"ngIf"],["hidePager","true",3,"totalResults",4,"ngIf"],["right",""],[1,"tw-btn-danger","tw-mb-3",3,"click","disabled"],[3,"confirm","modalId","type","buttonType","title","okText","cancelText"],["body",""],[1,"tw-mb-4"],[1,"tw-pill-danger"],[3,"confirm","modalId","buttonType","title","okText"],["id","selectedAppName",3,"label"],[3,"fieldType","values"],["id","selectedAppCreated",3,"label"],["id","selectedAppExpires",3,"label"],[3,"fieldType","values","customNoValue"],["role","alert",1,"tw-alert-warning"],[3,"confirm","modalId","type","buttonType","title","okText"],["role","alert",1,"tw-alert"],[1,"datatable","selectable","hover"],["id","descriptionHeader",1,"tw-hidden","md:tw-table-cell"],[1,"tw-w-1"],[1,"sr-only"],["id","userAppList"],["class","group",4,"ngFor","ngForOf"],[1,"group"],[1,"tw-max-w-0","tw-truncate",3,"click"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell"],[1,"tw-btn-link","tw-btn-small","group-hover:tw-text-blue-500",3,"click"],["aria-hidden","true",1,"fad","fa-pencil"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell",3,"click"],["hidePager","true",3,"totalResults"],["id","selectedAppLogoURL",3,"label"],["id","selectedAppDescription",3,"label"],["id","selectedAppURL",3,"label"],["id","DataEncryptedWarning"],[1,"tw-font-semibold","tw-text-sm","tw-mb-2"],[1,"tw-flex","tw-flex-wrap","tw-item-start","tw--mt-2","tw--ml-2"],[1,"tw-pt-2","tw-pl-2"],[1,"tw-pill"]],template:function(n,s){if(1&n){const r=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()(),e.DNE(5,ce,1,0,"app-simple-loader",5)(6,me,4,3,"div",6)(7,he,13,8,"table",7)(8,ge,1,1,"app-pager",8),e.k0s(),e.j41(9,"app-button-bar"),e.qex(10,9),e.j41(11,"button",10),e.bIt("click",function(){e.eBV(r);const m=e.sdS(15);return e.Njj(m.show())}),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(14,"app-confirmation-modal",11,0),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.revokeAll())}),e.qex(16,12),e.j41(17,"p",13),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.j41(20,"p",14),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(23,"app-confirmation-modal",15,1),e.bIt("confirm",function(){e.eBV(r);const m=e.sdS(36);return e.Njj(m.show())}),e.qex(25,12),e.j41(26,"app-form-row",16),e.nrm(27,"app-readonly",17),e.k0s(),e.DNE(28,fe,6,15),e.j41(29,"app-form-row",18),e.nrm(30,"app-readonly",17),e.k0s(),e.j41(31,"app-form-row",19),e.nrm(32,"app-readonly",20),e.k0s(),e.DNE(33,ve,4,3,"div",21)(34,Ue,8,4,"dl"),e.bVm(),e.k0s(),e.j41(35,"app-confirmation-modal",22,2),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.revokeSingle(null==s.selectedApp?null:s.selectedApp.clientId))}),e.qex(37,12),e.j41(38,"p",13),e.EFF(39),e.nI1(40,"translate"),e.j41(41,"strong"),e.EFF(42),e.k0s(),e.EFF(43),e.nI1(44,"translate"),e.j41(45,"strong"),e.EFF(46),e.k0s(),e.EFF(47,"."),e.k0s(),e.j41(48,"p"),e.EFF(49),e.nI1(50,"translate"),e.k0s(),e.bVm(),e.k0s()}2&n&&(e.R7$(3),e.JRh(e.bMT(4,42,"ServerDependent.Users.Applications.Access")),e.R7$(2),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",0==(null==s.userApps?null:s.userApps.length)&&!s.isLoading),e.R7$(),e.Y8G("ngIf",(null==s.userApps?null:s.userApps.length)>0),e.R7$(),e.Y8G("ngIf",(null==s.userApps?null:s.userApps.length)>0&&!s.isLoading),e.R7$(3),e.Y8G("disabled",(null==s.userApps?null:s.userApps.length)<=0),e.R7$(),e.SpI(" ",e.bMT(13,44,"Users.Applications.RevokeAll")," "),e.R7$(2),e.Y8G("modalId","revokeAllModal")("type","danger")("buttonType","danger")("title","Users.Applications.RevokeAll")("okText","Users.Applications.RevokeAll")("cancelText","Users.Applications.DontRevokeAll"),e.R7$(4),e.JRh(e.bMT(19,46,"Users.Applications.RevokeConfirm")),e.R7$(3),e.JRh(e.bMT(22,48,"Common.Delete.Warning")),e.R7$(2),e.Y8G("modalId","appInfoModal")("buttonType","danger")("title",null==s.selectedApp?null:s.selectedApp.clientName)("okText","Users.Applications.Revoke"),e.R7$(3),e.Y8G("label","Common.Name"),e.R7$(),e.Y8G("fieldType",s.ReadOnlyFieldType.Single)("values",e.eq3(56,U,null==s.selectedAppMap?null:s.selectedAppMap.clientName)),e.R7$(),e.vxM(s.duendeEnvironment?28:-1),e.R7$(),e.Y8G("label","Common.Created"),e.R7$(),e.Y8G("fieldType",s.ReadOnlyFieldType.Single)("values",e.eq3(58,U,null==s.selectedAppMap?null:s.selectedAppMap.created)),e.R7$(),e.Y8G("label","Common.Expires"),e.R7$(),e.Y8G("fieldType",s.ReadOnlyFieldType.Single)("values",e.eq3(60,U,null==s.selectedAppMap?null:s.selectedAppMap.expires))("customNoValue","Common.Never"),e.R7$(),e.vxM((null==s.selectedApp?null:s.selectedApp.scopes.length)<1?33:-1),e.R7$(),e.vxM((null==s.selectedApp?null:s.selectedApp.scopes.length)>0?34:-1),e.R7$(),e.Y8G("modalId","revokeAppModal")("type","danger")("buttonType","danger")("title","Users.Applications.RevokeApp")("okText","Users.Applications.RevokeYes"),e.R7$(4),e.SpI("",e.bMT(40,50,"Users.Applications.RevokeUserConfirm")," "),e.R7$(3),e.JRh(null==s.selectedApp?null:s.selectedApp.clientName),e.R7$(),e.SpI(" ",e.bMT(44,52,"Users.Applications.ForUser")," "),e.R7$(3),e.JRh(s.user.username),e.R7$(3),e.JRh(e.bMT(50,54,"Common.AreYouSureContinue")))},dependencies:[u.Sq,u.bT,j.B,S.d,A.Y,V.O,x.z,E.B,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return i})();class y{}var $=a(7263),Te=a(140),P=a(6354),Re=a(316),O=a(6536),Ce=a(6411),F=a(6026),T=a(2947),Me=a(526),Ie=a(9196),Se=a(6807),ye=a(7499),z=a(9550),Fe=a(4701),we=a(6728),ke=a(7778),D=a(9988),je=a(6037),Ae=a(7957),J=a(7329),Ee=a(1413),W=a(8412),$e=a(9172),De=a(1397),Ne=a(1655),Ge=a(6494),H=a(7883);const Le=i=>({"inactive disabled":i}),Be=i=>({"tw-text-blue-500":i});function Ye(i,o){1&i&&e.nrm(0,"app-simple-loader")}function Xe(i,o){1&i&&(e.j41(0,"div",13)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"Users.NoUsersFound")))}function Ve(i,o){1&i&&e.nrm(0,"span",29)}function xe(i,o){1&i&&(e.j41(0,"span",30),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Users.Filter.Deleted")," "))}function Pe(i,o){1&i&&(e.j41(0,"span",31),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Users.Filter.Blocked")," "))}function Oe(i,o){1&i&&(e.j41(0,"span",32),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"MergeUser.SourceUser")," "))}function ze(i,o){if(1&i){const t=e.RV6();e.j41(0,"tr",20)(1,"td",21),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectUser(s))}),e.DNE(2,Ve,1,0,"span",22),e.k0s(),e.j41(3,"td",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectUser(s))}),e.j41(4,"b",24),e.EFF(5),e.k0s()(),e.j41(6,"td",21),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectUser(s))}),e.EFF(7),e.k0s(),e.j41(8,"td",25),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectUser(s))}),e.DNE(9,xe,3,3,"span",26)(10,Pe,3,3,"span",27)(11,Oe,3,3,"span",28),e.k0s()()}if(2&i){const t=o.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(8,Le,t.subject==n.sourceUserId)),e.R7$(2),e.Y8G("ngIf",t.subject==n.destinationUserId),e.R7$(2),e.Y8G("ngClass",e.eq3(10,Be,t.subject!=n.sourceUserId)),e.R7$(),e.SpI(" ",t.username," "),e.R7$(2),e.SpI(" ",t.email," "),e.R7$(2),e.Y8G("ngIf",t.isDeleted),e.R7$(),e.Y8G("ngIf",t.isBlocked&&!t.isDeleted),e.R7$(),e.Y8G("ngIf",t.subject==n.sourceUserId)}}function Je(i,o){if(1&i&&(e.j41(0,"table",14)(1,"thead")(2,"tr")(3,"th",15)(4,"span",6),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.j41(7,"th",16),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"th",17),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"th",15)(14,"span",6),e.EFF(15),e.nI1(16,"translate"),e.k0s()()()(),e.j41(17,"tbody",18),e.DNE(18,ze,12,12,"tr",19),e.k0s()()),2&i){const t=e.XpG();e.R7$(5),e.JRh(e.bMT(6,5,"Common.Actions")),e.R7$(3),e.SpI(" ",e.bMT(9,7,"Users.Username")," "),e.R7$(3),e.SpI(" ",e.bMT(12,9,"Users.Email")," "),e.R7$(4),e.JRh(e.bMT(16,11,"Common.Status")),e.R7$(3),e.Y8G("ngForOf",t.pagedResult.results)}}function We(i,o){if(1&i){const t=e.RV6();e.j41(0,"app-pager",33),e.bIt("onGoToPage",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.goToPage(s))}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("totalResults",null==t.pagedResult?null:t.pagedResult.totalCount)("currentPage",t.page)("lastPage",null==t.pagedResult?null:t.pagedResult.pageCount)}}let He=(()=>{class i extends Ge.u{constructor(t,n,s,r,l,m,g){super(l,r,!0,g,m,s),this.userService=t,this.errorService=n,this.destinationUserId=null,this.destinationUserUsername=null,this.pageSize=8,this.page=1,this.term="",this.pageStream=new Ee.B}ngOnInit(){this.isLoading=!0,this.sourceUserId=this.data.sourceUserId,this.pageStream.pipe((0,P.T)(s=>(this.page=s,{searchTerm:this.term,page:s,pageSize:this.pageSize}))).pipe((0,W.X)(this.searchSource),(0,W.X)(this.enterKeySource),(0,$e.Z)({searchTerm:this.term,page:this.page,pageSize:this.pageSize}),(0,De.Z)(s=>(this.isLoading=!0,this.userService.getUsersLightweight(s.searchTerm,s.page,s.pageSize,s.filters,s.advancedFilters).pipe((0,Ne.c)(200))))).subscribe({next:s=>{this.pagedResult=s,this.isLoading=!1},error:s=>{this.errorService.handleError(s),this.isLoading=!1}})}mapSearchTerm(t){return this.term=t,{searchTerm:t,page:1,pageSize:this.pageSize,filters:null,advancedFilters:null}}goToPage(t){this.pageStream.next(t)}resourceIsReadOnly(t){return!1}selectUser(t){this.sourceUserId!=t.subject&&(this.destinationUserId==t.subject?this.destinationUserId=null:(this.destinationUserId=t.subject,this.destinationUserUsername=t.username))}canNext(){return null!==this.destinationUserId}onNext(){this.dtoSnapshot.destinationUserId=this.destinationUserId}hosted(){}getStepDTO(){const t={};return t.sourceUserId=this.sourceUserId,t.destinationUserId=this.destinationUserId,t}getStepSummary(){const t=new Map;return t.set("Destination User",[this.destinationUserUsername]),t}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.D),e.rXU(M.I),e.rXU(T.Ix),e.rXU(p.c$),e.rXU(v.tw),e.rXU(H.i),e.rXU(T.nX))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-merge-user-search"]],inputs:{data:"data"},standalone:!1,features:[e.Vt3],decls:20,vars:14,consts:[["searchUserName",""],[1,"cms","tw-mb-6"],["id","searchContainer",1,"tw-mb-2"],[1,"tw-flex","tw-bg-white","tw-border","tw-border-grey-300","tw-opacity-75","tw-cursor-text","tw-rounded","focus-within:tw-opacity-100","focus-within:tw-border-blue-400","tw-transition-all","tw-ease-in-out"],["for","searchUserName",1,"tw-flex","tw-items-center","tw-text-grey-500","tw-m-0","tw-ml-3"],["aria-hidden","true",1,"far","fa-search","tw-text-sm"],[1,"sr-only"],["id","searchUserName","type","search",1,"tw-bg-transparent","tw-border-0","tw-text-base","tw-leading-tight","tw-px-2","tw-py-2","tw-w-full","focus:tw-outline-none","tw-transition-all","tw-ease-in-out",3,"ngModelChange","keyup","ngModel","placeholder"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],[1,"tw-py-2"],["class","datatable selectable hover",4,"ngIf"],[3,"totalResults","currentPage","lastPage","onGoToPage",4,"ngIf"],["role","alert",1,"tw-alert"],[1,"datatable","selectable","hover"],[1,"tw-w-1"],["id","sortUsername",1,"md:tw-w-1/3","lg:tw-w-1/3"],[1,"tw-hidden","lg:tw-table-cell"],["id","usersTable"],["class","group userRow",3,"ngClass",4,"ngFor","ngForOf"],[1,"group","userRow",3,"ngClass"],[1,"tw-hidden","tw-truncate","tw-max-w-0","lg:tw-table-cell",3,"click"],["class","fas fa-check",4,"ngIf"],[1,"tw-truncate","tw-max-w-0",3,"click"],[3,"ngClass"],[3,"click"],["class","tw-pill-danger",4,"ngIf"],["class","tw-pill-warning",4,"ngIf"],["class","tw-pill",4,"ngIf"],[1,"fas","fa-check"],[1,"tw-pill-danger"],[1,"tw-pill-warning"],[1,"tw-pill"],[3,"onGoToPage","totalResults","currentPage","lastPage"]],template:function(n,s){if(1&n){const r=e.RV6();e.j41(0,"div",1)(1,"div",1)(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()(),e.j41(5,"div",2)(6,"div",3)(7,"label",4),e.nrm(8,"span",5),e.j41(9,"span",6),e.EFF(10),e.nI1(11,"translate"),e.k0s()(),e.j41(12,"input",7,0),e.nI1(14,"translate"),e.mxI("ngModelChange",function(m){return e.eBV(r),e.DH7(s.searchTerm,m)||(s.searchTerm=m),e.Njj(m)}),e.bIt("keyup",function(m){return e.eBV(r),e.Njj(s.search(m))}),e.k0s()(),e.DNE(15,Ye,1,0,"app-simple-loader",8)(16,Xe,4,3,"div",9),e.j41(17,"div",10),e.DNE(18,Je,19,13,"table",11)(19,We,1,3,"app-pager",12),e.k0s()()()}2&n&&(e.R7$(3),e.SpI(" ",e.bMT(4,8,"MergeUser.UserSearch"),""),e.R7$(7),e.JRh(e.bMT(11,10,"Common.Search")),e.R7$(2),e.FS9("placeholder",e.bMT(14,12,"Users.SearchPlaceholder")),e.R50("ngModel",s.searchTerm),e.R7$(3),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)<1&&!s.isLoading),e.R7$(2),e.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)>0&&!s.isLoading),e.R7$(),e.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)>0&&!s.isLoading))},dependencies:[u.YU,u.Sq,u.bT,c.me,c.BC,c.vS,j.B,S.d,p.D9],encapsulation:2})}}return i})();var Qe=a(8575),h=function(i){return i.ignore="Ignore",i.replace="Replace",i.combine="Combine",i}(h||{});function Ze(i,o){1&i&&e.nrm(0,"app-simple-loader")}function Ke(i,o){1&i&&(e.j41(0,"div",2)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"MergeUser.NoClaimsFound")))}function qe(i,o){if(1&i&&(e.j41(0,"option"),e.EFF(1),e.k0s()),2&i){const t=o.$implicit,n=e.XpG(2);e.R7$(),e.JRh(n.mergeActionEnum[t])}}function et(i,o){if(1&i&&(e.j41(0,"option"),e.EFF(1),e.k0s()),2&i){const t=o.$implicit,n=e.XpG(3);e.R7$(),e.JRh(n.mergeActionEnum[t])}}function tt(i,o){if(1&i){const t=e.RV6();e.j41(0,"tr",13)(1,"td",14)(2,"b"),e.EFF(3),e.k0s()(),e.j41(4,"td")(5,"div",7)(6,"select",15),e.mxI("ngModelChange",function(s){const r=e.eBV(t).$implicit;return e.DH7(r.action,s)||(r.action=s),e.Njj(s)}),e.DNE(7,et,2,1,"option",9),e.k0s()()()()}if(2&i){const t=o.$implicit,n=e.XpG(2);e.R7$(3),e.SpI(" ",t.claimType," "),e.R7$(3),e.R50("ngModel",t.action),e.R7$(),e.Y8G("ngForOf",n.mergeActions)}}function st(i,o){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",3)(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()(),e.j41(5,"div")(6,"app-form-row",4)(7,"app-form-toggle",5)(8,"input",6),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.deleteAfterMerge,s)||(r.deleteAfterMerge=s),e.Njj(s)}),e.k0s()()(),e.j41(9,"app-form-row",4)(10,"div",7)(11,"select",8),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.changeDefaultMergeAction,s)||(r.changeDefaultMergeAction=s),e.Njj(s)}),e.bIt("change",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.updateAllMergeActions())}),e.DNE(12,qe,2,1,"option",9),e.k0s()()()(),e.j41(13,"table",10)(14,"thead")(15,"tr")(16,"th",11),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"th",11),e.EFF(20),e.nI1(21,"translate"),e.k0s()()(),e.j41(22,"tbody"),e.DNE(23,tt,8,3,"tr",12),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(3),e.Lme(" ",e.bMT(4,14,"MergeUser.UserClaimsHelp"),": ",t.destinationUserUsername,""),e.R7$(3),e.Y8G("id","deleteAfterMerge")("label",t.getDeleteAfterMergeLabel()),e.R7$(),e.Y8G("id","deleteAfterMerge"),e.R7$(),e.Y8G("checked",t.deleteAfterMerge),e.R50("ngModel",t.deleteAfterMerge),e.R7$(),e.Y8G("id","setAllActions")("label","MergeUser.SetAllActions"),e.R7$(2),e.R50("ngModel",t.changeDefaultMergeAction),e.R7$(),e.Y8G("ngForOf",t.mergeActions),e.R7$(5),e.SpI(" ",e.bMT(18,16,"Claims.Title")," "),e.R7$(3),e.SpI(" ",e.bMT(21,18,"MergeUser.MergeAction")," "),e.R7$(3),e.Y8G("ngForOf",t.claimMergeActions)}}let nt=(()=>{class i{constructor(t,n){this.userService=t,this.translate=n,this.claimMergeActions=[],this.changeDefaultMergeAction=h.ignore,this.mergeActions=Object.keys(h),this.mergeActionEnum=h,this.destinationUserUsername="",this.deleteAfterMerge=!1}ngOnInit(){this.isLoading=!0,this.userService.getUser(this.dtoSnapshot.destinationUserId).subscribe({next:s=>{this.destinationUser=s,this.destinationUserUsername=s.username}}),this.userService.getUser(this.data.sourceUserId).subscribe({next:s=>{this.isLoading=!1,this.sourceUser=s,this.setupAvaliableClaimActions(s)}})}setupAvaliableClaimActions(t){t.claims=t.claims.filter(n=>"phone_number_verified"!=n.type&&"email_verified"!=n.type),t.roles.length>0&&this.claimMergeActions.push({claimType:"role",action:h.ignore}),t.claims.forEach(n=>{this.claimMergeActions.find(s=>s.claimType==n.type)||this.claimMergeActions.push({claimType:n.type,action:h.ignore})})}updateAllMergeActions(){this.claimMergeActions.forEach(t=>{t.action=this.changeDefaultMergeAction})}getDeleteAfterMergeLabel(){return this.translate.instant("MergeUser.DeleteAfterMerge").replace("{0}",this.sourceUser.username)}canNext(){return this.claimMergeActions.some(t=>t.action!=h.ignore)}onNext(){}hosted(){}getStepDTO(){const t={};return t.claimMergeActions=this.claimMergeActions.filter(n=>n.action!=h.ignore),t.deleteAfterMerge=this.deleteAfterMerge,t}getStepSummary(){const t=new Map;var n;n=!0===this.deleteAfterMerge?"Yes":"No",t.set(this.getDeleteAfterMergeLabel(),[n]);var s=[],r=[],l=this.claimMergeActions.filter(d=>d.action!=h.ignore),m=l.find(d=>"role"==d.claimType);null!=m&&m.action!=h.ignore&&(this.sourceUser.roles.forEach(d=>{s.push("role: "+d.name)}),m.action==h.replace&&this.destinationUser.roles.forEach(d=>{r.push("role: "+d.name)})),this.sourceUser.claims.forEach(d=>{l.some(_=>_.claimType==d.type)&&s.push(d.type+": "+d.value)}),this.destinationUser.claims.forEach(d=>{l.some(_=>_.claimType==d.type&&_.action==h.replace)&&r.push(d.type+": "+d.value)});var g=s.filter(d=>!r.includes(d));g.length>0&&t.set(this.translate.instant("MergeUser.ClaimsAdded"),g);var w=r.filter(d=>!s.includes(d));return w.length>0&&t.set(this.translate.instant("MergeUser.ClaimsRemoved"),w),t}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.D),e.rXU(p.c$))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-merge-user-claims"]],inputs:{data:"data"},standalone:!1,decls:4,vars:3,consts:[[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["role","alert",1,"tw-alert"],[1,"cms","tw-mb-6"],[3,"id","label"],[3,"id"],["id","deleteAfterMerge","type","checkbox","name","deleteAfterMerge",1,"tw-form-switch__input",3,"ngModelChange","checked","ngModel"],[1,"tw-form-select"],[1,"tw-form-control",3,"ngModelChange","change","ngModel"],[4,"ngFor","ngForOf"],[1,"datatable"],[1,"md:tw-w-1/3","lg:tw-w-1/3"],["class","group",4,"ngFor","ngForOf"],[1,"group"],[1,"tw-truncate","tw-max-w-0"],[1,"tw-form-control",3,"ngModelChange","ngModel"]],template:function(n,s){1&n&&(e.j41(0,"div"),e.DNE(1,Ze,1,0,"app-simple-loader",0)(2,Ke,4,3,"div",1)(3,st,24,20,"div",0),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",s.claimMergeActions.length<1&&!s.isLoading),e.R7$(),e.Y8G("ngIf",s.claimMergeActions.length>0&&!s.isLoading))},dependencies:[u.Sq,u.bT,c.xH,c.y7,c.Zm,c.wz,c.BC,c.vS,S.d,A.Y,z.m,p.D9],encapsulation:2})}}return i})();class it extends Ae.p{constructor(o,t){super(),this.nameComponentMap.set(D.$.MergeUser,[new J.W(He,{stepName:"MergeUserSearchComponent",sourceUserId:o,sourceUserUsername:t}),new J.W(nt,{stepName:"MergeUserClaimsComponent",sourceUserId:o,sourceUserUsername:t})]),this.nameTitleMap.set(D.$.MergeUser,new Qe.J("MergeUser.Title","MergeUser.MergeUserSummary"))}}var rt=a(1715);function at(i,o){if(1&i&&(e.j41(0,"div",5),e.nrm(1,"div",17),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.xc7("width",t.progressPercent+"%"),e.BMQ("aria-valuenow",t.progressPercent)}}function ot(i,o){}function lt(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",18),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.nextTab())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("disabled",!t.canNext()),e.R7$(),e.JRh(e.bMT(2,2,"Common.Next"))}}function ct(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.submit())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.JRh(e.bMT(2,1,"Common.Save")))}function mt(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.previousTab())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.JRh(e.bMT(2,1,"Common.Back")))}function dt(i,o){1&i&&(e.j41(0,"a",15),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.JRh(e.bMT(2,1,"StarterMode.UpgradeAdminUI")))}let pt=(()=>{class i extends je.J{constructor(t,n,s,r,l){super(n,s,r),this.userService=t,this.errorService=n,this.toastr=s,this.translate=r,this.router=l,this.wizardName=D.$.MergeUser}ngOnInit(){this.wizardProvider=new it(this.sourceUserId,this.sourceUserUsername),super.ngOnInit()}submit(){var t=this.getWizardDto();this.userService.MergeUser(t.sourceUserId,t.destinationUserId,t.claimMergeActions,t.deleteAfterMerge).subscribe({complete:()=>{this.finishWizard(),this.clearComponents(),this.toastr.success(this.translate.instant("MergeUser.SuccessMessage"),this.translate.instant("MergeUser.SuccessTitle")),this.hideWizard();var n=this.router.url.split("/")[1];this.router.navigate(["/"+n+"/users/"+t.destinationUserId],{})},error:n=>{this.errorService.handleError(n)}})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.D),e.rXU(M.I),e.rXU(v.tw),e.rXU(p.c$),e.rXU(T.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-merge-user-modal"]],inputs:{sourceUserId:"sourceUserId",sourceUserUsername:"sourceUserUsername"},standalone:!1,features:[e.Jv_([]),e.Vt3],decls:23,vars:15,consts:[[1,"modal-header"],[1,"modal-title",3,"id"],["type","button",1,"modal-close",3,"click"],["aria-hidden","true",1,"fas","fa-times"],[1,"sr-only"],[1,"modal-progress"],[1,"modal-body","scrollbars"],["appStepHost",""],[1,"modal-body-fade"],[1,"modal-footer"],[1,"tw-flex","tw-items-center"],[1,"tw-mr-auto"],["class","tw-btn-success tw-mr-3","id","nextBtn",3,"disabled","click",4,"ngIf"],["class","tw-btn-success tw-mr-3","id","submitBtn",3,"click",4,"ngIf"],["class","tw-btn-secondary","id","backBtn",3,"click",4,"ngIf"],["id","upgradeAdminUI","href","starter-mode/teaser",1,"tw-btn","tw-ml-4"],["id","cancelBtn",1,"tw-btn-link","tw--mr-4",3,"click"],["role","progressbar",1,"modal-progress-bar"],["id","nextBtn",1,"tw-btn-success","tw-mr-3",3,"click","disabled"],["id","submitBtn",1,"tw-btn-success","tw-mr-3",3,"click"],["id","backBtn",1,"tw-btn-secondary",3,"click"]],template:function(n,s){if(1&n&&(e.j41(0,"div",0)(1,"h5",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"button",2),e.bIt("click",function(){return s.hideWizard()}),e.nrm(5,"span",3),e.j41(6,"span",4),e.EFF(7),e.nI1(8,"translate"),e.k0s()()(),e.DNE(9,at,2,3,"div",5),e.j41(10,"div",6),e.DNE(11,ot,0,0,"ng-template",7),e.k0s(),e.nrm(12,"div",8),e.j41(13,"div",9)(14,"div",10)(15,"div",11),e.DNE(16,lt,3,4,"button",12)(17,ct,3,3,"button",13)(18,mt,3,3,"button",14)(19,dt,3,3,"a",15),e.k0s(),e.j41(20,"button",16),e.bIt("click",function(){return s.cancelWizard()}),e.EFF(21),e.nI1(22,"translate"),e.k0s()()()),2&n){let r;e.R7$(),e.Y8G("id",s.titleId),e.R7$(),e.JRh(e.bMT(3,9,null!==(r=null==s.wizardTitles?null:s.wizardTitles.setupTitle)&&void 0!==r?r:"")),e.R7$(5),e.JRh(e.bMT(8,11,"Common.Close")),e.R7$(2),e.vxM(s.showProgress?9:-1),e.R7$(7),e.Y8G("ngIf",s.index<(null==s.wizardSteps?null:s.wizardSteps.length)),e.R7$(),e.Y8G("ngIf",s.index==(null==s.wizardSteps?null:s.wizardSteps.length)),e.R7$(),e.Y8G("ngIf",!s.initialStep()),e.R7$(),e.vxM(s.initialStep()&&null!=s.asAny&&s.asAny.displayUpgradeIcon?19:-1),e.R7$(2),e.JRh(e.bMT(22,13,"Common.Cancel"))}},dependencies:[u.bT,rt.t,p.D9],encapsulation:2})}}return i})();var ut=a(4692);const ht=["claimsComponent"],gt=i=>[i];function ft(i,o){if(1&i){const t=e.RV6();e.j41(0,"form",23)(1,"app-form-row",24)(2,"app-form-toggle",25),e.nrm(3,"input",26),e.k0s()(),e.j41(4,"app-form-row",24),e.nrm(5,"app-readonly",27),e.nI1(6,"readOnlyValue"),e.k0s(),e.j41(7,"app-form-row",28)(8,"input",29),e.bIt("keyup",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.checkForPolicyUserForm("firstName","given_name",null==s.userForm.controls.firstName?null:s.userForm.controls.firstName.value))}),e.k0s()(),e.j41(9,"app-form-row",28)(10,"input",30),e.bIt("keyup",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.checkForPolicyUserForm("lastName","family_name",null==s.userForm.controls.lastName?null:s.userForm.controls.lastName.value))}),e.k0s()(),e.j41(11,"app-form-row",28)(12,"input",31),e.bIt("keyup",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.checkForPolicyUserForm("username","name",null==s.userForm.controls.username?null:s.userForm.controls.username.value))}),e.k0s()(),e.j41(13,"app-form-row",28)(14,"input",32),e.bIt("keyup",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.checkForPolicyUserForm("email","email",null==s.userForm.controls.email?null:s.userForm.controls.email.value))}),e.k0s()()()}if(2&i){const t=e.XpG();e.Y8G("formGroup",t.userForm),e.R7$(),e.Y8G("id","Blocked")("label","UserDetails.Active"),e.R7$(),e.Y8G("id","Blocked")("isTraffic",!0)("isAlt",!0),e.R7$(2),e.Y8G("id","userId")("label","Common.ID"),e.R7$(),e.Y8G("fieldType",t.ReadOnlyFieldType.Single)("values",e.eq3(25,gt,e.bMT(6,23,t.user.subject))),e.R7$(2),e.Y8G("id","FirstName")("label","Users.FirstName")("help",t.ifUserInfoPolicyClaim("given_name",null==t.userForm.controls.firstName?null:t.userForm.controls.firstName.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","LastName")("label","Users.LastName")("help",t.ifUserInfoPolicyClaim("family_name",null==t.userForm.controls.lastName?null:t.userForm.controls.lastName.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","Username")("label","Users.Username")("help",t.ifUserInfoPolicyClaim("name",null==t.userForm.controls.username?null:t.userForm.controls.username.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","Email")("label","Users.Email")("help",t.ifUserInfoPolicyClaim("email",null==t.userForm.controls.email?null:t.userForm.controls.email.value)?"Common.Policy":""),e.R7$(),e.BMQ("Required",t.requireEmail)}}function vt(i,o){1&i&&(e.j41(0,"app-form-row",24),e.nrm(1,"app-date-time",37),e.k0s()),2&i&&(e.Y8G("id","LockoutEnd")("label","Users.LockoutEnd"),e.R7$(),e.Y8G("displayType","datetime"))}function bt(i,o){if(1&i){const t=e.RV6();e.j41(0,"form",23)(1,"app-form-row",24)(2,"app-form-toggle",25)(3,"input",33),e.bIt("change",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.clearLockoutEnd())}),e.k0s()()(),e.DNE(4,vt,2,3,"app-form-row",34),e.j41(5,"app-form-row",35)(6,"app-form-toggle",25),e.nrm(7,"input",36),e.k0s()()()}if(2&i){const t=e.XpG();e.Y8G("formGroup",t.userForm),e.R7$(),e.Y8G("id","LockoutEnabled")("label","Users.LockoutEnabled"),e.R7$(),e.Y8G("id","LockoutEnabled")("isTraffic",!0)("isAlt",!1),e.R7$(2),e.Y8G("ngIf",null==t.userForm.controls.lockoutEnabled?null:t.userForm.controls.lockoutEnabled.value),e.R7$(),e.Y8G("id","EnabledTwoFactor")("label","UserDetails.EnabledTwoFactor")("help","ServerDependent.UserDetails.EnabledTwoFactorHelp")("isLast",!0),e.R7$(),e.Y8G("id","EnabledTwoFactor")("isTraffic",!0)("isAlt",!1)}}function Ut(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const s=e.XpG(),r=e.sdS(31),l=e.sdS(40);return e.Njj(s.passwordWebhookSetup?r.show():l.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"UserDetails.ChangePassword")," "))}function _t(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){e.eBV(t);const s=e.XpG(),r=e.sdS(46),l=e.sdS(55);return e.Njj(s.resetMfaWebhookSetup?r.show():l.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"UserDetails.ResetMfa")," "))}function Tt(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",40),e.bIt("click",function(){e.eBV(t),e.XpG();const s=e.sdS(18);return e.Njj(s.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Delete.Title")," "))}function Rt(i,o){if(1&i){const t=e.RV6();e.j41(0,"button",41),e.bIt("click",function(){e.eBV(t),e.XpG();const s=e.sdS(22);return e.Njj(s.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Delete.UndoDelete")," "))}function Ct(i,o){if(1&i){const t=e.RV6();e.j41(0,"app-merge-user-modal",42),e.bIt("wizardCancel",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.hideWizard())})("hide",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.hideWizard())})("finish",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.reload())}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("sourceUserId",t.user.subject)("sourceUserUsername",t.user.username)}}let Mt=(()=>{class i extends Ce.A{get ReadOnlyFieldType(){return X.t}constructor(t,n,s,r,l,m,g,w,d,_,os,ls,cs,ms){super(ls),this.fb=t,this.userService=n,this.errorService=s,this.router=r,this.translate=l,this.claimsService=m,this.titleService=g,this.toastr=w,this.localize=d,this.configService=_,this.apClaimsService=os,this.modalService=cs,this.activateRoute=ms,this.isDeleting=!1,this.requiredCount=0,this.dateTimeDisplayType=O.e,this.requireEmail=!0,this.inFlight=!1}ngOnInit(){this.configService.getConfig(!0).pipe((0,k.s)(1)).subscribe(t=>{this.passwordWebhookSetup=t.resetPasswordConfigured,this.resetMfaWebhookSetup=t.resetMfaConfigured,this.requireEmail=t.requireEmailInUsers,this.combinedObservable=this.claimsService.getClaimTypes(null,null).pipe((0,Te.v)(this.userService.getCachedUser()),(0,P.T)(([n,s])=>({claimTypes:n,user:s}))).subscribe({next:n=>{this.user=n.user,this.claimTypes=n.claimTypes,this.createForms();const s=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Details")+" - "+C.$9.SITE_TITLE;this.titleService.setTitle(s)},error:n=>{this.errorService.handleError(n)}})})}ngOnDestroy(){this.combinedObservable.unsubscribe()}get unsavedChanges(){return!this.isDeleting&&(this.claimsComponent.claimsForm.dirty||this.userForm.dirty)}onDeactivate(){}createForms(){this.userForm=this.fb.group({subject:[this.user.subject,c.k0.required],username:[{value:this.user.username,disabled:this.notAllowedToEditUserInfo("name",this.user.username)},[c.k0.required,(0,$.Zt)()]],email:[{value:this.user.email,disabled:this.notAllowedToEditUserInfo("name",this.user.email)},this.requireEmail?[c.k0.required,Re.D]:[]],firstName:[{value:this.user.firstName,disabled:this.notAllowedToEditUserInfo("given_name",this.user.firstName)},c.k0.required],lastName:[{value:this.user.lastName,disabled:this.notAllowedToEditUserInfo("family_name",this.user.lastName)},c.k0.required],isBlocked:[this.user.isBlocked,c.k0.required],lockoutEnd:[this.user.lockoutEnd],lockoutEnabled:[this.user.lockoutEnabled],isDeleted:[this.user.isDeleted],twoFactorEnabled:[this.user.twoFactorEnabled]})}deleteUser(){this.userService.deleteUser(this.user).subscribe(t=>{this.isDeleting=!0;const n=this.localize.translateRoute("/users");this.router.navigate([n]);const s=this.translate.instant("Users.Delete.Confirmation").replace("{0}",this.user.username);this.toastr.success(s,this.translate.instant("Notifications.Saving Success Title"))},t=>{const n={toastBody:this.translate.instant("Notifications.Delete Error Title"),toastTitle:this.translate.instant("Notifications.Delete User Message"),forceToast:!0};(this.errorService.handleError(t,n)&b.I.Toast)!==b.I.Toast&&this.toastr.error(n.toastBody,n.toastTitle)})}unDeleteUser(){const t=JSON.parse(JSON.stringify(this.user));t.isDeleted=!1,this.userService.updateUser(t).subscribe({next:n=>{this.user=t,this.userService.userSubject.next(t);const s=this.translate.instant("Notifications.Saving Success Title"),r=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(r,s)},error:n=>{this.errorService.handleError(n,{forceToast:!0})}})}submit(){const t=this.userForm.value,n=this.user.claims.slice(),s=this.claimsComponent.requiredClaims;for(const l of s){const m=n.find(g=>g.type===l.type);m?m.value=l.value:n.push(l)}const r=Object.assign(t,{claims:n},{roles:this.user.roles});this.userService.updateUser(r).subscribe({next:l=>{this.userForm.controls.username.dirty&&(this.user.username=this.userForm.controls.username.value);const m=this.translate.instant("Notifications.Saving Success Title"),g=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(g,m),this.userService.userSubject.next(r),this.userForm.markAsPristine(),this.userForm.markAsUntouched(),this.claimsComponent.claimsForm.form.markAsUntouched(),this.claimsComponent.claimsForm.form.markAsPristine()},error:l=>{this.errorService.handleError(l,{forceToast:!0})}})}resetPassword(){this.inFlight=!0,this.userService.resetPassword(this.user.subject).subscribe(t=>{this.inFlight=!1;const n=this.translate.instant("Notifications.Saving Success Title"),s=this.translate.instant("Notifications.Reset Success Message");this.toastr.success(s,n)},t=>{this.inFlight=!1,this.errorService.handleError(t,{forceToast:!0})})}resetMfa(){this.inFlight=!0,this.userService.resetMfa(this.user.subject).subscribe(t=>{this.inFlight=!1;const n=this.translate.instant("Notifications.Saving Success Title"),s=this.translate.instant("Notifications.MFA Success Message");this.toastr.success(s,n)},t=>{this.inFlight=!1,this.errorService.handleError(t,{forceToast:!0})})}ifUserInfoPolicyClaim(t,n){const s=new y;return s.type=t,s.value=n,this.apClaimsService.isPolicyClaim(s)}notAllowedToEditUserInfo(t,n){const s=new y;return s.type=t,s.value=n,this.apClaimsService.notAllowedToEditClaim(s)}notAllowedToEditClaim(t){return this.apClaimsService.notAllowedToEditClaim(t)}getHelpTextString(t){return this.apClaimsService.isPolicyClaim(t)?"DateTime"==t.format?"Common.PolicyWithUTCNotice":"Common.Policy":"DateTime"==t.format?"Common.Dates.UTCWarning":""}checkForPolicyUserForm(t,n,s){const r=new y;r.type=n,r.value=s,this.apClaimsService.notAllowedToEditClaim(r)&&this.userForm.controls[t].setErrors({incorrect:!0})}getClaimType(t){return this.claimTypes.find(n=>n.name===t.type)}getAllowedValues(t){const n=this.claimTypes.find(s=>s.name===t.type);return n&&n.allowedValues||[]}clearLockoutEnd(){this.userForm.get("lockoutEnd").reset()}goToLink(t){window.open(t,"_blank")}showWizard(t){this.modalService.show(t,{id:F.R.Id,ariaLabelledBy:F.R.TileId,ariaDescribedby:F.R.DescriptionId,backdrop:"static"})}hideWizard(){this.modalService.hide(F.R.Id)}onFinish(){}reload(){}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(c.ze),e.rXU(f.D),e.rXU(M.I),e.rXU(T.Ix),e.rXU(p.c$),e.rXU(Me.X),e.rXU(I.hE),e.rXU(v.tw),e.rXU(G.QG),e.rXU(Ie.w),e.rXU(Se.B),e.rXU(ye.o),e.rXU(L.I8),e.rXU(T.nX))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-details"]],viewQuery:function(n,s){if(1&n&&e.GBs(ht,7),2&n){let r;e.mGM(r=e.lsd())&&(s.claimsComponent=r.first)}},standalone:!1,features:[e.Vt3],decls:61,vars:57,consts:[["claimsComponent",""],["deleteUserModal",""],["mergeUserModal",""],["unDeleteUserModal",""],["resetPasswordModal",""],["resetPasswordSetupModal",""],["resetMfaModal",""],["resetMfaSetupModal",""],["id","editUserDetails",1,"tw-container","tw-mx-auto"],[3,"formGroup",4,"ngIf"],["id","requiredClaimsComponent",3,"claimTypes","claims"],["id","submitBtn",1,"tw-btn-success","tw-mr-3","tw-mb-3",3,"click","disabled"],["class","tw-btn-secondary tw-mr-3 tw-mb-3","data-toggle","modal","id","resetPasswordButton","type","button",3,"click",4,"ngIf"],["class","tw-btn-secondary tw-mr-3 tw-mb-3","data-toggle","modal","id","resetMfaButton","type","button",3,"click",4,"ngIf"],["right",""],["type","button","data-toggle","modal",1,"tw-btn-secondary","tw-mb-3","tw-mr-3",3,"click"],["class","tw-btn-danger tw-mb-3 tw-mr-3","type","button","data-toggle","modal",3,"click",4,"ngIf"],["id","undoDelete","class","tw-btn-danger tw-mb-3","type","button","data-toggle","modal",3,"click",4,"ngIf"],[3,"delete","modalId","resourceName","warning"],[3,"confirm","modalId","type","buttonType","title","okText"],["body",""],[3,"confirm","modalId","title","okText","inFlight"],[3,"confirm","modalId","buttonType","title","okText"],[3,"formGroup"],[3,"id","label"],[3,"id","isTraffic","isAlt"],["id","Blocked","formControlName","isBlocked","type","checkbox",1,"tw-form-switch__input"],[3,"fieldType","values"],[3,"id","label","help"],["type","text","name","FirstName","id","FirstName","formControlName","firstName","required","",1,"tw-form-control",3,"keyup"],["type","text","name","LastName","id","LastName","formControlName","lastName","required","",1,"tw-form-control",3,"keyup"],["type","text","name","Username","id","Username","formControlName","username","required","",1,"tw-form-control",3,"keyup"],["type","email","name","Email","id","Email","formControlName","email",1,"tw-form-control",3,"keyup"],["id","LockoutEnabled","formControlName","lockoutEnabled","type","checkbox",1,"tw-form-switch__input",3,"change"],[3,"id","label",4,"ngIf"],[3,"id","label","help","isLast"],["id","EnabledTwoFactor","formControlName","twoFactorEnabled","type","checkbox",1,"tw-form-switch__input"],["id","LockoutEnd","name","lockoutEnd","formControlName","lockoutEnd","aria-describedby","toErrorLabel",3,"displayType"],["data-toggle","modal","id","resetPasswordButton","type","button",1,"tw-btn-secondary","tw-mr-3","tw-mb-3",3,"click"],["data-toggle","modal","id","resetMfaButton","type","button",1,"tw-btn-secondary","tw-mr-3","tw-mb-3",3,"click"],["type","button","data-toggle","modal",1,"tw-btn-danger","tw-mb-3","tw-mr-3",3,"click"],["id","undoDelete","type","button","data-toggle","modal",1,"tw-btn-danger","tw-mb-3",3,"click"],[3,"wizardCancel","hide","finish","sourceUserId","sourceUserUsername"]],template:function(n,s){if(1&n){const r=e.RV6();e.j41(0,"div",8),e.DNE(1,ft,15,27,"form",9),e.nrm(2,"app-required-claims-form",10,0),e.DNE(4,bt,8,14,"form",9),e.k0s(),e.j41(5,"app-button-bar")(6,"button",11),e.bIt("click",function(){return e.eBV(r),e.Njj(s.submit())}),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.DNE(9,Ut,3,3,"button",12)(10,_t,3,3,"button",13),e.qex(11,14),e.j41(12,"button",15),e.bIt("click",function(){e.eBV(r);const m=e.sdS(20);return e.Njj(s.showWizard(m))}),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.DNE(15,Tt,3,3,"button",16)(16,Rt,3,3,"button",17),e.bVm(),e.k0s(),e.j41(17,"app-delete-confirmation-modal",18,1),e.bIt("delete",function(){return e.eBV(r),e.Njj(s.deleteUser())}),e.k0s(),e.DNE(19,Ct,1,2,"ng-template",null,2,e.C5r),e.j41(21,"app-confirmation-modal",19,3),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.unDeleteUser())}),e.qex(23,20),e.j41(24,"p"),e.EFF(25),e.nI1(26,"translate"),e.j41(27,"strong"),e.EFF(28),e.k0s(),e.EFF(29,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(30,"app-confirmation-modal",21,4),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.resetPassword())}),e.qex(32,20),e.j41(33,"p"),e.EFF(34),e.nI1(35,"translate"),e.j41(36,"strong"),e.EFF(37),e.k0s(),e.EFF(38,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(39,"app-confirmation-modal",22,5),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.goToLink("documentation/Webhooks/webhooks.html"))}),e.qex(41,20),e.j41(42,"p"),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(45,"app-confirmation-modal",21,6),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.resetMfa())}),e.qex(47,20),e.j41(48,"p"),e.EFF(49),e.nI1(50,"translate"),e.j41(51,"strong"),e.EFF(52),e.k0s(),e.EFF(53,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(54,"app-confirmation-modal",22,7),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.goToLink("documentation/Webhooks/webhooks.html"))}),e.qex(56,20),e.j41(57,"p"),e.EFF(58),e.nI1(59,"translate"),e.k0s(),e.bVm(),e.k0s(),e.nrm(60,"app-can-deactivate")}if(2&n){const r=e.sdS(3);e.R7$(),e.Y8G("ngIf",s.user),e.R7$(),e.Y8G("claimTypes",s.claimTypes)("claims",null==s.user?null:s.user.claims),e.R7$(2),e.Y8G("ngIf",s.user),e.R7$(2),e.Y8G("disabled",(null==s.userForm?null:s.userForm.invalid)||!r.isFormValid()||(null==s.userForm?null:s.userForm.pristine)&&(null==r.claimsForm?null:r.claimsForm.form.pristine)),e.R7$(),e.SpI(" ",e.bMT(8,43,"Common.Save")," "),e.R7$(2),e.Y8G("ngIf",!(null!=s.user&&s.user.isDeleted)),e.R7$(),e.Y8G("ngIf",!(null!=s.user&&s.user.isDeleted)),e.R7$(3),e.SpI(" ",e.bMT(14,45,"MergeUser.MergeUserButton")," "),e.R7$(2),e.Y8G("ngIf",!(null!=s.user&&s.user.isDeleted)),e.R7$(),e.Y8G("ngIf",null==s.user?null:s.user.isDeleted),e.R7$(),e.Y8G("modalId","deleteUserModal")("resourceName",null==s.user?null:s.user.username)("warning","Users.Delete.AuditingPurposes"),e.R7$(4),e.Y8G("modalId","unDeleteUserModal")("type","danger")("buttonType","danger")("title","Common.Delete.UndoDelete")("okText","Common.Delete.TitleUndo"),e.R7$(4),e.SpI("",e.bMT(26,47,"Common.Delete.ConfirmUndoDelete")," "),e.R7$(3),e.JRh(null==s.user?null:s.user.username),e.R7$(2),e.Y8G("modalId","resetPasswordModal")("title","Common.ResetPassword.Confirm")("okText","Common.ResetPassword.Title")("inFlight",s.passwordWebhookSetup&&s.inFlight),e.R7$(4),e.SpI("",e.bMT(35,49,"Common.ResetPassword.AreYouSureSimple")," "),e.R7$(3),e.JRh(null==s.user?null:s.user.username),e.R7$(2),e.Y8G("modalId","resetPasswordSetupModal")("buttonType",null)("title","Common.ResetPassword.HowToSetupTitle")("okText","Common.Documentation"),e.R7$(4),e.JRh(e.bMT(44,51,"Common.ResetPassword.HowToSetup")),e.R7$(2),e.Y8G("modalId","resetMfaModal")("title","Common.ResetMfa.Confirm")("okText","Common.ResetMfa.Title")("inFlight",s.inFlight),e.R7$(4),e.SpI("",e.bMT(50,53,"Common.ResetMfa.AreYouSureSimple")," "),e.R7$(3),e.JRh(null==s.user?null:s.user.username),e.R7$(2),e.Y8G("modalId","resetMfaSetupModal")("buttonType",null)("title","Common.ResetMfa.HowToSetupTitle")("okText","Common.Documentation"),e.R7$(4),e.JRh(e.bMT(59,55,"Common.ResetMfa.HowToSetup"))}},dependencies:[u.bT,c.qT,c.me,c.Zm,c.BC,c.cb,c.YS,c.j4,c.JD,A.Y,z.m,Fe.u,O.Z,V.O,we.E,x.z,E.B,ke.w,pt,p.D9,ut.u],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return i})();function It(i,o){1&i&&e.nrm(0,"app-simple-loader")}function St(i,o){1&i&&(e.j41(0,"div",8)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"UserLogins.NoLogins")))}function yt(i,o){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td",16)(2,"b"),e.EFF(3),e.k0s()(),e.j41(4,"td",17),e.EFF(5),e.k0s(),e.j41(6,"td",17),e.EFF(7),e.k0s(),e.j41(8,"td")(9,"button",18),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2),l=e.sdS(6);return r.modalInfo(s),e.Njj(l.show())}),e.nrm(10,"span",19),e.j41(11,"span",13),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()()}if(2&i){const t=o.$implicit;e.R7$(3),e.JRh(t.providerDisplayName),e.R7$(2),e.JRh(t.loginProvider),e.R7$(2),e.JRh(t.providerKey),e.R7$(5),e.JRh(e.bMT(13,4,"Common.Revoke"))}}function Ft(i,o){if(1&i&&(e.j41(0,"table",9)(1,"thead")(2,"tr")(3,"th",10),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"th",11),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",11),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",12)(13,"span",13),e.EFF(14),e.nI1(15,"translate"),e.k0s()()()(),e.j41(16,"tbody",14),e.DNE(17,yt,14,6,"tr",15),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,5,"UserLogins.ProviderDisplayName")),e.R7$(3),e.JRh(e.bMT(8,7,"UserLogins.LoginProvider")),e.R7$(3),e.JRh(e.bMT(11,9,"UserLogins.ProviderKey")),e.R7$(4),e.JRh(e.bMT(15,11,"Common.Actions")),e.R7$(3),e.Y8G("ngForOf",t.userLogins)}}function wt(i,o){if(1&i&&e.nrm(0,"app-pager",20),2&i){const t=e.XpG();e.Y8G("totalResults",null==t.userLogins?null:t.userLogins.length)}}let kt=(()=>{class i{constructor(t,n,s){this.userService=t,this.translate=n,this.toastr=s,this.userLogins=[],this.isLoading=!0}ngOnInit(){this.userService.getCachedUser().pipe((0,k.s)(1)).subscribe(t=>{this.user=t,this.userService.getUserLogins(this.user.subject).subscribe(n=>{this.userLogins=n,this.isLoading=!1})})}modalInfo(t){this.selectedLogin=t}deleteLogin(t){this.userService.revokeUserLogin(this.user.subject,t).subscribe(()=>{this.toastr.success("Login Revoked",this.translate.instant("Notifications.Success")),this.userLogins.splice(this.userLogins.indexOf(t),1)},n=>{this.toastr.error(n,this.translate.instant("Notifications.Failure"))})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.D),e.rXU(p.c$),e.rXU(v.tw))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-logins"]],standalone:!1,decls:13,vars:13,consts:[["revokeLoginModal",""],[1,"tw-container","tw-mx-auto"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable hover",4,"ngIf"],["hidePager","true",3,"totalResults",4,"ngIf"],[3,"confirm","modalId","type","buttonType","title","okText"],["body",""],["role","alert",1,"tw-alert"],[1,"datatable","hover"],[1,"md:tw-w-1/4"],[1,"tw-hidden","md:tw-table-cell"],[1,"tw-w-1"],[1,"sr-only"],["id","userLoginsList"],[4,"ngFor","ngForOf"],[1,"tw-max-w-0","tw-truncate"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell"],["value","Delete","data-dismiss","modal","data-toggle","modal","data-target","#revokeLoginModal",1,"tw-btn-link","tw-btn-small","tw-text-red-500",3,"click"],["aria-hidden","true",1,"fas","fa-plug"],["hidePager","true",3,"totalResults"]],template:function(n,s){if(1&n){const r=e.RV6();e.j41(0,"div",1),e.DNE(1,It,1,0,"app-simple-loader",2)(2,St,4,3,"div",3)(3,Ft,18,13,"table",4)(4,wt,1,1,"app-pager",5),e.k0s(),e.j41(5,"app-confirmation-modal",6,0),e.bIt("confirm",function(){return e.eBV(r),e.Njj(s.deleteLogin(s.selectedLogin))}),e.qex(7,7),e.j41(8,"p"),e.EFF(9),e.nI1(10,"translate"),e.j41(11,"b"),e.EFF(12),e.k0s()(),e.bVm(),e.k0s()}if(2&n){let r;e.R7$(),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",0==(null==s.userLogins?null:s.userLogins.length)&&!s.isLoading),e.R7$(),e.Y8G("ngIf",(null==s.userLogins?null:s.userLogins.length)>0),e.R7$(),e.Y8G("ngIf",(null==s.userLogins?null:s.userLogins.length)>0),e.R7$(),e.Y8G("modalId","revokeLoginModal")("type","danger")("buttonType","danger")("title","UserLogins.RevokeExternalLogin")("okText","Common.Revoke"),e.R7$(4),e.SpI("",e.bMT(10,11,"UserLogins.RevokeLoginConfirmationText")," for "),e.R7$(3),e.JRh(null!==(r=null==s.selectedLogin?null:s.selectedLogin.providerDisplayName)&&void 0!==r?r:null==s.selectedLogin?null:s.selectedLogin.providerKey)}},dependencies:[u.Sq,u.bT,j.B,S.d,E.B,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return i})();var jt=a(4572),At=a(1594),Et=a(3519),$t=a(4112);const Dt=["RolePicker"];let Nt=(()=>{class i{constructor(t,n,s,r,l,m){this.rolesService=t,this.userService=n,this.titleService=s,this.translate=r,this.toastr=l,this.securityService=m,this.availableRoles=[],this.assignedRoles=[],this.restrictedPolicies=[],this.roleSearchValue=""}ngOnInit(){this.combinedObservable=(0,jt.z)([this.rolesService.getRoles(),this.userService.getCachedUser()]).pipe((0,At.$)()).subscribe(t=>{this.availableRoles=t[0],this.assignedRoles=t[1].roles,this.user=t[1],this.matchRoles();const n=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Roles")+" - "+C.$9.SITE_TITLE;this.titleService.setTitle(n)})}ngAfterViewInit(){this.rolePicker.assignedStream.subscribe(t=>{this.addRoles(t)}),this.rolePicker.unAssignedStream.subscribe(t=>{this.deleteRoles(t)})}ngOnDestroy(){this.combinedObservable.unsubscribe()}isPolicyRole(t){const n=this.securityService.policyClaims;for(let s=0;s<n.length;s++)if("role"===n[s].type&&n[s].value===t)return!0;return!1}matchRoles(){for(const t of this.assignedRoles)for(const n of this.availableRoles)n.name===t.name&&this.availableRoles.splice(this.availableRoles.indexOf(n),1)}addRoles(t){const n=t.map(s=>s.name);this.userService.addUserRoles(this.user.subject,n).subscribe(s=>{this.availableRoles=(0,$.Yt)(this.availableRoles.slice(),t);const r=this.assignedRoles.slice();this.assignedRoles=r.concat(t),this.user.roles=this.assignedRoles.slice(),this.userService.userSubject.next(this.user),this.toastr.success(this.translate.instant("Roles.Success"),this.translate.instant("Notifications.Success"))},s=>{401===s.status&&this.toastr.warning(this.translate.instant("Roles.AssignUnauthorized"),this.translate.instant("Notifications.Unauthorized"))})}deleteRoles(t){const n=t.map(s=>s.name);this.userService.deleteUserRoles(this.user.subject,n).subscribe(s=>{this.assignedRoles=(0,$.Yt)(this.assignedRoles.slice(),t);const r=this.availableRoles.slice();this.availableRoles=r.concat(t),this.user.roles=this.assignedRoles.slice(),this.userService.userSubject.next(this.user),this.toastr.success(this.translate.instant("Roles.Success"),this.translate.instant("Notifications.Success"))},s=>{401===s.status&&this.toastr.warning(this.translate.instant("Roles.UnassignUnauthorized"),this.translate.instant("Notifications.Unauthorized"))})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(Et.P),e.rXU(f.D),e.rXU(I.hE),e.rXU(p.c$),e.rXU(v.tw),e.rXU(H.i))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-user-roles"]],viewQuery:function(n,s){if(1&n&&e.GBs(Dt,7),2&n){let r;e.mGM(r=e.lsd())&&(s.rolePicker=r.first)}},standalone:!1,decls:3,vars:5,consts:[["RolePicker",""],["id","editUserRoles",1,"tw-container","tw-mx-auto"],[3,"assignedInput","availableInput","restrictedInput","assignedSearch","availableSearch"]],template:function(n,s){1&n&&(e.j41(0,"div",1),e.nrm(1,"app-common-picker",2,0),e.k0s()),2&n&&(e.R7$(),e.Y8G("assignedInput",s.assignedRoles)("availableInput",s.availableRoles)("restrictedInput",s.restrictedPolicies)("assignedSearch",!1)("availableSearch",!0))},dependencies:[$t.f],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return i})();var Gt=a(1796);const Lt=[{path:"",redirectTo:"details",pathMatch:"full"},{path:"details",component:Mt,canDeactivate:[B.M]},{path:"roles",component:Nt},{path:"additionaldetails",component:se,canDeactivate:[B.M]},{path:"apps",component:_e},{path:"userlogins",component:kt},{path:"useraudits",component:te.L,canActivate:[Gt.S,K._,q.q]},{path:"sessions",component:Z.Z,canActivate:[ee.O]}];let Bt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[p.h.forChild({extend:!0}),R.iI.forChild(Lt),p.h,R.iI]})}}return i})();var Yt=a(1683),Xt=a(4811),Vt=a(2571),xt=a(5663),Pt=a(8389),Ot=a(5731),zt=a(7677),Jt=a(7175),Wt=a(367),Ht=a(8455),Qt=a(1993),Zt=a(4193),Kt=a(9475),qt=a(6599),es=a(3665),ts=a(2334),ss=a(4367),ns=a(9947),is=a(9115),rs=a(9973);let as=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({providers:[Xt.M,xt.Q],imports:[Bt,u.MD,c.YN,c.X1,L.Q_,Yt.Y,p.h,Vt.A,Q.Ss,G.XE,Kt.F,Wt.m,Ot.i,Zt.c,es.t,Jt.c,Pt.w,qt.Y,R.iI,ts.ClaimTypesModule,zt.N,Ht.p,Qt.E,ss.N,ns.a,is.P,rs.s,R.iI]})}}return i})()}}]);